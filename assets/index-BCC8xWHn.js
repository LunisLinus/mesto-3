(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"698d0731-ae53-4a36-a0c5-4c07e24b8856","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),j=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),J=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),R=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),H=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),z=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),K=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),G=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(u),Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),x=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");G(t,n).then(r=>{e.classList.toggle("card__like-button_is-active"),o.textContent=r.likes.length}).catch(r=>{console.log(r)})},X=e=>{e.remove()},F=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r)=>{const s=Q(),l=s.querySelector(".card__like-button"),B=s.querySelector(".card__control-button_type_delete"),y=s.querySelector(".card__image"),I=s.querySelector(".card__like-count");return y.src=e.link,y.alt=e.name,s.querySelector(".card__title").textContent=e.name,I.textContent=e.likes.length,e.likes.some(V=>V._id===r)&&l.classList.add("card__like-button_is-active"),o&&l.addEventListener("click",()=>o(l,e._id,I)),e.owner&&r&&e.owner._id!==r?B.remove():n&&B.addEventListener("click",()=>n(s,e._id)),t&&y.addEventListener("click",()=>t({name:e.name,link:e.link})),s},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})},Z=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},M=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},ee=(e,t,o)=>{if(t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),!t.validity.valid){Z(e,t,t.validationMessage,o);return}M(e,t,o)},te=e=>e.some(t=>!t.validity.valid),U=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},oe=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{te(e)?U(t,o):oe(t,o)},re=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);A(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{ee(e,r,t),A(o,n,t)})})},S=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>M(e,r,t)),U(n,t)},ne=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>n.preventDefault()),re(o,e)})},_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},T=document.querySelector(".places__list"),b=document.querySelector(".popup_type_edit"),f=b.querySelector(".popup__form"),O=f.querySelector(".popup__input_type_name"),D=f.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),d=C.querySelector(".popup__form"),se=d.querySelector(".popup__input_type_card-name"),ce=d.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_image"),w=L.querySelector(".popup__image"),ae=L.querySelector(".popup__caption"),le=document.querySelector(".profile__edit-button"),ie=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit-avatar"),p=E.querySelector(".popup__form"),ue=p.querySelector(".popup__input"),P=document.querySelector(".popup_type_remove-card"),de=P.querySelector(".popup__form");let h=null,v=null;const a=(e,t,o="Сохранить",n="Сохранение...")=>{e?t.textContent=n:t.textContent=o},N=({name:e,link:t})=>{w.src=t,w.alt=e,ae.textContent=e,m(L)},pe=e=>{e.preventDefault();const t=e.submitter;a(!0,t),R({name:O.value,about:D.value}).then(o=>{q.textContent=o.name,g.textContent=o.about,i(b)}).catch(o=>{console.log(o)}).finally(()=>{a(!1,t)})},me=e=>{e.preventDefault();const t=e.submitter;a(!0,t),H(ue.value).then(o=>{k.style.backgroundImage=`url(${o.avatar})`,p.reset(),i(E)}).catch(o=>{console.log(o)}).finally(()=>{a(!1,t)})},_e=e=>{e.preventDefault();const t=e.submitter;a(!0,t,"Создать","Создание..."),z({name:se.value,link:ce.value}).then(o=>{T.prepend(F(o,{onPreviewPicture:N,onLikeIcon:x,onDeleteCard:W},o.owner._id)),d.reset(),i(C)}).catch(o=>{console.log(o)}).finally(()=>{a(!1,t,"Создать")})},fe=e=>{if(e.preventDefault(),h&&v){const t=e.submitter;a(!0,t,"Да","Удаление..."),K(v).then(()=>{X(h),i(P)}).catch(o=>{console.log(o)}).finally(()=>{a(!1,t,"Да")})}},W=(e,t)=>{h=e,v=t,m(P)};f.addEventListener("submit",pe);d.addEventListener("submit",_e);p.addEventListener("submit",me);de.addEventListener("submit",fe);le.addEventListener("click",()=>{O.value=q.textContent,D.value=g.textContent,S(f,_),m(b)});k.addEventListener("click",()=>{p.reset(),S(p,_),m(E)});ie.addEventListener("click",()=>{d.reset(),S(d,_),m(C)});ne(_);const ye=document.querySelectorAll(".popup");ye.forEach(e=>{Y(e)});Promise.all([J(),j()]).then(([e,t])=>{q.textContent=t.name,g.textContent=t.about,k.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{T.append(F(o,{onPreviewPicture:N,onLikeIcon:x,onDeleteCard:W},t._id))})}).catch(e=>{console.log(e)});
