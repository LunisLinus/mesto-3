(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"698d0731-ae53-4a36-a0c5-4c07e24b8856","Content-Type":"application/json"}},_=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),X=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(_),D=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(_),Y=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(_),Z=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(_),ee=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(_),te=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(_),oe=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(_),re=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),V=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");oe(t,n).then(r=>{e.classList.toggle("card__like-button_is-active"),o.textContent=r.likes.length}).catch(r=>{console.log(r)})},ne=e=>{e.remove()},H=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r)=>{const s=re(),u=s.querySelector(".card__like-button"),b=s.querySelector(".card__control-button_type_delete"),h=s.querySelector(".card__image"),q=s.querySelector(".card__like-count");return h.src=e.link,h.alt=e.name,s.querySelector(".card__title").textContent=e.name,q.textContent=e.likes.length,e.likes.some(c=>c._id===r)&&u.classList.add("card__like-button_is-active"),o&&u.addEventListener("click",()=>o(u,e._id,q)),e.owner&&r&&e.owner._id!==r?b.remove():n&&b.addEventListener("click",()=>n(s,e._id)),t&&h.addEventListener("click",()=>t({name:e.name,link:e.link})),s},j=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");m(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",j)},m=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",j)},se=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{m(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&m(e)})},ce=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},J=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},le=(e,t,o)=>{if(t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),!t.validity.valid){ce(e,t,t.validationMessage,o);return}J(e,t,o)},ie=e=>e.some(t=>!t.validity.valid),R=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ae=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},M=(e,t,o)=>{ie(e)?R(t,o):ae(t,o)},ue=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);M(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{le(e,r,t),M(o,n,t)})})},B=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>J(e,r,t)),R(n,t)},pe=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>n.preventDefault()),ue(o,e)})},L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},W=document.querySelector(".places__list"),P=document.querySelector(".popup_type_edit"),C=P.querySelector(".popup__form"),z=C.querySelector(".popup__input_type_name"),K=C.querySelector(".popup__input_type_description"),w=document.querySelector(".popup_type_new-card"),f=w.querySelector(".popup__form"),de=f.querySelector(".popup__input_type_card-name"),me=f.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_image"),O=x.querySelector(".popup__image"),_e=x.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),F=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_edit-avatar"),S=U.querySelector(".popup__form"),he=S.querySelector(".popup__input"),$=document.querySelector(".popup_type_remove-card"),ve=$.querySelector(".popup__form"),p=document.querySelector(".popup_type_info"),g=p==null?void 0:p.querySelector(".popup__info"),k=p==null?void 0:p.querySelector(".popup__list"),N=document.querySelector(".header__logo");let E=null,I=null;const d=(e,t,o="Сохранить",n="Сохранение...")=>{e?t.textContent=n:t.textContent=o},G=({name:e,link:t})=>{O.src=t,O.alt=e,_e.textContent=e,y(x)},Se=e=>{e.preventDefault();const t=e.submitter;d(!0,t),Y({name:z.value,about:K.value}).then(o=>{A.textContent=o.name,T.textContent=o.about,m(P)}).catch(o=>{console.log(o)}).finally(()=>{d(!1,t)})},be=e=>{e.preventDefault();const t=e.submitter;d(!0,t),Z(he.value).then(o=>{F.style.backgroundImage=`url(${o.avatar})`,S.reset(),m(U)}).catch(o=>{console.log(o)}).finally(()=>{d(!1,t)})},Le=e=>{e.preventDefault();const t=e.submitter;d(!0,t,"Создать","Создание..."),ee({name:de.value,link:me.value}).then(o=>{W.prepend(H(o,{onPreviewPicture:G,onLikeIcon:V,onDeleteCard:Q},o.owner._id)),f.reset(),m(w)}).catch(o=>{console.log(o)}).finally(()=>{d(!1,t,"Создать")})},Ce=e=>{if(e.preventDefault(),E&&I){const t=e.submitter;d(!0,t,"Да","Удаление..."),te(I).then(()=>{ne(E),m($)}).catch(o=>{console.log(o)}).finally(()=>{d(!1,t,"Да")})}},Q=(e,t)=>{E=e,I=t,y($)},qe=()=>{D().then(e=>{if(!p||!g||!k)return;g.innerHTML="",k.innerHTML="";const t=new Set;let o=0;const n=new Map;e.forEach(c=>{c.owner&&c.owner._id&&t.add(c.owner._id);const i=Array.isArray(c.likes)?c.likes:[];o+=i.length,i.forEach(a=>{const v=n.get(a._id)||{count:0,name:a.name||"—"};v.count+=1,n.set(a._id,v)})});let r="—",s=0;n.forEach(({count:c,name:i})=>{c>s&&(s=c,r=i)});const u=[{term:"Всего пользователей:",value:t.size},{term:"Всего лайков:",value:o},{term:"Максимально лайков от одного:",value:s},{term:"Чемпион лайков:",value:r}],b=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item");u.forEach(({term:c,value:i})=>{const a=b.cloneNode(!0);a.querySelector(".popup__info-term").textContent=c,a.querySelector(".popup__info-description").textContent=String(i),g.append(a)});const h=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item");[...e].sort((c,i)=>{var a,v;return(((a=i.likes)==null?void 0:a.length)||0)-(((v=c.likes)==null?void 0:v.length)||0)}).slice(0,5).forEach(c=>{const i=h.cloneNode(!0);i.textContent=c.name,k.append(i)}),y(p)}).catch(e=>{console.log(e)})};C.addEventListener("submit",Se);f.addEventListener("submit",Le);S.addEventListener("submit",be);ve.addEventListener("submit",Ce);fe.addEventListener("click",()=>{z.value=A.textContent,K.value=T.textContent,B(C,L),y(P)});F.addEventListener("click",()=>{S.reset(),B(S,L),y(U)});ye.addEventListener("click",()=>{f.reset(),B(f,L),y(w)});N&&N.addEventListener("click",qe);pe(L);const ge=document.querySelectorAll(".popup");ge.forEach(e=>{se(e)});Promise.all([D(),X()]).then(([e,t])=>{A.textContent=t.name,T.textContent=t.about,F.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{W.append(H(o,{onPreviewPicture:G,onLikeIcon:V,onDeleteCard:Q},t._id))})}).catch(e=>{console.log(e)});
